Язык команд, используемый в рабочих (payload) файлах, основан на [ducky script 1.0](https://web.archive.org/web/20220816200129/http://github.com/hak5darren/USB-Rubber-Ducky/wiki/Duckyscript)  
изначально сделанном для USB Rubber Ducky. Это сделано для того чтобы старые  
скрипты по-прежнему работали с PocketAdmin. Однако изначальный язык получил  
много расширений и изменений, так что это не будет работать в обратную сторону.  
  
Вот краткое изложение правил:  
  
1. Кодировка текста должна быть ASCII. Любой символ в скрипте, который не  
является печатным в ASCII приводит к тому, что остальная часть строки  
игнорируется. Используемые здесь кавычки не являются частью команд и  
просто используются для обозначения начала и конца команды.  
  
2. Все команды **специальных функций** должны быть помещены в начало  
строки и заканчиваться символом новой строки. Другие команды, такие  
так как команды **нажатия клавиш** или **управления мышью** могут быть размещены  
несколько раз подряд на одной строке, разделенные пробелами. В таком случае все  
эти нажатия клавиш или действия мыши считаются сделанными одновременно.  
  
3. Некоторые команды принимают аргументы, которые следуют за ключевым словом  
команды. Эти аргументы будут обозначаться **n** для десятичных чисел, **x**  
для шестнадцатеричных чисел, **s** для строк или символов. Ключевое слово и  
его аргумент должны быть разделены ровно одним пробелом.  
  
4. Шестнадцатеричные аргументы должны иметь префикс 0x при использовании в скриптах,  
но заглавность буквы не имеет значения (например, 0x02ac, 0x02AC, 0x02aC одинаковы).  
Размер десятичного аргумента может быть от 1 до 6 символов, размер шестнадцатеричного  
аргумента от 1 до 4 символов, строковый аргумент может быть от 0 до 1000 символов.  
  
5. Ключевое слово команды вместе с ее **числовым** аргументом рассматривается  
как одна команда (например, "KEYCODE 0x04", "MOUSE_RIGHT 10"). Вы можете иметь  
до 10 различных команд **нажатия клавиш** или **управления мышью** в одной строке.  
Вы можете одновременно нажимать до 4 клавиш клавиатуры (не являющихся модификаторами),  
а также любую комбинацию клавиш модификаторов.  
  
6. Особых требований к порядку команд на одной и той же строке нет (например,  
"CTRL SHIFT a b" и "a SHIFT CTRL b" — это одно и то же). Также, нет ограничений  
в том, какие комбинации клавиш разрешены, вы можете использовать любую  
произвольную комбинацию команд **нажатия клавиш** и **управления мышью**.  
  
  
### Ниже приведен полный список всех команд для рабочих файлов:  
  
#### команды специальных функций:  
* "REM **s**"  --- переходит к следующей строке, используется для комментариев  
* "DEFAULT_DELAY **n**"  --- устанавливает, сколько миллисекунд ждать после каждой команды  
* "DEFAULTDELAY **n**"  --- то же самое, что и "DEFAULT_DELAY **n**"  
* "ONACTION_DELAY **n**"  --- применяет задержку по умолчанию, но только после некоторых команд  
* "DELAY **n**"  --- ждёт указанное количество миллисекунд  
* "WAITFOR_INIT"  --- ждёт, пока компьютер завершит инициализацию устройства  
* "WAITFOR_CAPSLOCK"  --- ждёт, пока пользователь вручную не нажмёт CapsLock 2 раза  
* "WAITFOR_RESET"  --- ждёт, пока компьютер не перезагрузит устройство (например, при перезагрузке самого ПК)  
* "ALLOW_EXIT"  --- даёт пользователю 1 секунду, чтобы нажать CapsLock, выходит из скрипта при нажатии  
* "REPEAT_START"  --- отмечает начало блока команд для повтора  
* "REPEAT **n**"  --- повторяет предыдущий командный блок указанное количество раз  
* "STRING_DELAY **n**"  --- устанавливает, как долго держать клавиши нажатыми/отпущенными с помощью "STRING **s**"  
* "STRING **s**"  --- печатает строку символов указанную в аргументе (в формате ASCII)  
* "HOLD **s**"  --- удерживает указанные клавиши клавиатуры/мыши зажатыми  
* "RELEASE"  --- отпускает все клавиши клавиатуры/мыши, удерживаемые командой "HOLD **s**"  
* "SETNUM_ON"  --- переключает NUMLOCK, пока не загорится его светодиод  
* "SETNUM_OFF"  --- переключает NUMLOCK, пока его светодиод не погаснет  
* "SETCAPS_ON"  --- переключает CAPSLOCK, пока не загорится его светодиод  
* "SETCAPS_OFF"  --- переключает CAPSLOCK, пока его светодиод не погаснет  
* "SETSCROLL_ON"  --- переключает SCROLLLOCK, пока не загорится его светодиод  
* "SETSCROLL_OFF"  --- переключает SCROLLLOCK, пока его светодиод не погаснет  
  
#### команды нажатия клавиш:  
* "GUI"  --- нажимает левую клавишу-модификатор GUI  
* "WINDOWS"  --- то же самое, что и "GUI"  
* "CTRL"  --- нажимает левую клавишу-модификатор CTRL  
* "CONTROL"  --- то же самое, что и "CTRL"  
* "SHIFT"  --- нажимает левую клавишу-модификатор SHIFT  
* "ALT"  --- нажимает левую клавишу-модификатор ALT  
* "RGUI"  --- нажимает правую клавишу-модификатор GUI  
* "RCTRL"  --- нажимает правую клавишу-модификатор CTRL  
* "RSHIFT"  --- нажимает правую клавишу-модификатор SHIFT  
* "RALT"  --- нажимает правую клавишу-модификатор ALT  
*  
* "KEYCODE **n**"  --- нажимает клавишу чей HID-код указан (десятичный)  
* "KEYCODE **x**"  --- нажимает клавишу чей HID-код указан (шестнадцатеричный)  
* "MENU"  --- клавиша для открытия меню (часто то же самое, что от правого щелчка)  
* "APP"  --- то же самое, что и "MENU"  
* "ENTER"  
* "RETURN"  --- то же самое, что и "ENTER"  
* "DOWN"  
* "LEFT"  
* "RIGHT"  
* "UP"  
* "DOWNARROW"  --- то же самое, что "DOWN"  
* "LEFTARROW"  --- то же самое, что и "LEFT"  
* "RIGHTARROW"  --- то же самое, что "RIGHT"  
* "UPARROW"  --- то же самое, что "UP"  
* "PAUSE"  
* "BREAK"  --- то же самое, что и "PAUSE"  
* "CAPSLOCK"  
* "DELETE"  
* "END"  
* "ESC"  
* "ESCAPE"  --- то же самое, что и "ESC"  
* "HOME"  
* "INSERT"  
* "NUMLOCK"  
* "PAGEUP"  
* "PAGEDOWN"  
* "PRINTSCREEN"  
* "SCROLLLOCK"  
* "SPACE"  
* "SPACEBAR"  --- то же самое, что и "SPACE"  
* "TAB"  
* "F1"  
* "F2"  
* "F3"  
* "F4"  
* "F5"  
* "F6"  
* "F7"  
* "F8"  
* "F9"  
* "F10"  
* "F11"  
* "F12"  
* Печатные символы ASCII, кроме пробела ("a", "b", "G", "/" итд.)  
*  
* "KP_SLASH"  --- клавиша кейпада "/"  
* "KP_ASTERISK"  --- клавиша кейпада "*"  
* "KP_MINUS"  --- клавиша кейпада "-"  
* "KP_PLUS"  --- клавиша кейпада "+"  
* "KP_ENTER"  --- клавиша кейпада ENTER  
* "KP_1"  --- клавиша кейпада "1" или END  
* "KP_2"  --- клавиша кейпада "2" или DOWNARROW  
* "KP_3"  --- клавиша кейпада "3" или PAGEDOWN  
* "KP_4"  --- клавиша кейпада "4" или LEFTARROW  
* "KP_5"  --- клавиша кейпада "5"  
* "KP_6"  --- клавиша кейпада "6" или RIGHTARROW  
* "KP_7"  --- клавиша кейпада "7" или HOME  
* "KP_8"  --- клавиша кейпада "8" или UPARROW  
* "KP_9"  --- клавиша кейпада "9" или PAGEUP  
* "KP_0"  --- клавиша кейпада "0" или INSERT  
* "KP_PERIOD"  --- клавиша кейпада "." или DELETE  
  
  
#### команды управления мышью:  
* "MOUSE_LEFTCLICK"  
* "MOUSE_RIGHTCLICK"  
* "MOUSE_MIDCLICK"  
*  
* "MOUSE_RIGHT **n**"  --- переместить курсор мыши вправо на **n** единиц  
* "MOUSE_LEFT **n**"  --- переместить курсор мыши влево на **n** единиц  
* "MOUSE_UP **n**"  --- переместить курсор мыши вверх на **n** единиц  
* "MOUSE_DOWN **n**"  --- переместить курсор мыши вниз на **n** единиц  
* "MOUSE_SCROLLDOWN **n**"  --- прокрутить колёсико мыши на **n** единиц на себя  
* "MOUSE_SCROLLUP **n**"  --- прокрутить колесо мыши на **n** единиц от себя  
  
---
  
Ниже приведено более подробное описание некоторых команд:  
  
1. Команда "WAITFOR_INIT" предназначена для использования при запуске, как самая первая в  
рабочем скрипте. Она периодически нажимает клавишу CapsLock и ждёт ответа компьютера.  
После того, как компьютер ответит запросом на включение индикатора CapsLock, эта команда  
обеспечит, чтобы CapsLock стал выключен. Если используется конфигурация HID+MSD (по умолчанию),  
то "WAITFOR_INIT" также будет ждать, пока не будет отправлена ​​хотя бы 1 команда на чтение  
к интерфейсу MSD, чтобы убедиться, что он также настроен и работает. Так вы сможете обеспечить,  
что компьютер готов принимать нажатия клавиш, прежде чем вы на самом деле попытаетесь  
их отправить. Даже если была довольно длительная задержка с запуском из-за того, что драйверы  
не были установлены итд, ваш рабочий скипт сможет успешно работать с первого раза, без  
нужды использовать большую постоянную задержку в скрипте и тратить больше времени, чем необходимо.  
  
2. Команда "WAITFOR_CAPSLOCK" ждёт, пока пользователь вручную не нажмёт CapsLock 2 раза  
(на настоящей клавиатуре), и только после этого продолжается выполнение рабочего скрипта.  
Это полезно, когда вы точно не знаете, как долго устройство должно ждать в определенном  
месте рабочего скрипта. Например, вы можете запускать какую-то программу или ждать пока  
появится окно UAC итд. В зависимости от ситуации может потребоваться разное количество  
времени до выполнения следующей части скрипта. Кроме того, вы можете использовать эту  
команду всякий раз, когда вам нужно смешать ввод через badusb и ввод вручную. Например,  
badusb входит в какую-то онлайн учётную запись, но вам нужно решить тест CAPTCHA; поэтому  
вы приостанавливаете рабочий скрипт и решаете CAPTCHA вручную, а затем PocketAdmin может  
продолжить исполнение скрипта. Или, может быть, вы выбираете загрузочный диск в меню BIOS,  
но вы точно не уверены, в каком порядке будут располагаться диски; поэтому вы выбираете  
диск вручную и продолжаете скрипт потом, итд.  
  
3. Команда "WAITFOR_RESET" ожидает, пока компьютер не отправит устройству сигнал USB сброса,  
и в основном предназначена для обнаружения перезагрузки ПК. В зависимости от вашей ситуации   
для перезагрузки ПК может потребоваться разное время, но после перезагрузки обычно есть  
очень ограниченное количество времени на вход в BIOS/bootmenu итд; это делает обычные  
фиксированные задержки неподходящими для скриптов, которые предполагают перезагрузку ПК  
и дальнейший вход в BIOS. Имейте ввиду, что если устройство будет отключено от питания,  
то выполнение скрипта не будет продолжено. В таком случае можно будет использовать сканер ОС,  
чтобы выбрать подходящий скрипт для вашего BIOS, после того как питание будет снова включено.  
  
4. "SETNUM_ON", "SETNUM_OFF", "SETCAPS_ON", "SETCAPS_OFF", "SETSCROLL_ON",  
"SETSCROLL_OFF" — это команды, которые переключают NUMLOCK, CAPSLOCK, SCROLLLOCK  
до тех пор, пока соответствующие светодиоды не загорятся или не погаснут. Когда нужное  
состояние светодиода достигнуто, устройство переходит к следующей команде в скрипте.  
Эти команды могут быть полезны, например, когда вы хотите использовать ALT-коды Windows,  
для которых необходимо, чтобы NUMLOCK был включен. Или же, например, чтобы убедиться что  
CAPSLOCK выключен, прежде чем вы наберете какую-либо команду где важен регистр символов.  
  
5. Команда "ONACTION_DELAY **n**" похожа на "DEFAULT_DELAY **n**" и по факту является  
её альтернативой. То есть вы не можете использовать их одновременно и если одна из  
этих команд встречается в скрипте, она заменяет эффект, который был от предыдущей.  
Обе эти команды используются для автоматической вставки указанной задержки (в миллисекундах)  
после последующих команд. Различия в том что "DEFAULT_DELAY **n**" вставляет задержку после  
любой строки скрипта, включая саму "DEFAULT_DELAY **n**", а также "REM **s**", "DELAY **n**",  
пустые строки итд; в то время как "ONACTION_DELAY **n**" добавляет задержку только после  
"STRING **s**", "HOLD **s**", "RELEASE", или какой-нибудь комбинации команд **нажатия клавиш**  
и **управления мышью**. Команда "DEFAULT_DELAY **n**" существует только для совместимости со  
старым ducky script и не рекомендуется для использования в ваших собственных (новых) скриптах.  
  
6. Команда "ALLOW_EXIT" позволяет остановить выполнение текущего рабочего файла. Она будет  
ждать 1 секунду, наблюдая за состоянием индикатора CapsLock. Если клавиша CapsLock была  
нажата 2 или более раз, то рабочий скрипт будет остановлен, а устройство вернется в состояние  
ожидания. В этом случае пользователь может, например, вызвать какой-то другой скрипт по запросу.  
Если во время ожидания не были обнаружены переключения CapsLock, выполнение рабочего скрипта  
будет продолжено. Вы должны убедиться, что ПК успешно сконфигурировал устройство  до того,  
как встретится эта команда. Обычно эта команда наиболее полезна после динамической задержки,  
например две команды подряд "WAITFOR_INIT", "ALLOW_EXIT" позволят вам иметь скрипт, который  
можно заблокировать, непрерывно нажимая CapsLock при вставлении устройства (так вам не нужно  
будет разбирать корпус устройства чтобы использовать для этого кнопку дискового режима).  
  
7. Команда "STRING_DELAY **n**" позволяет снизить скорость с которой последующие  
команды "STRING **s**" будут вводить указанные символы. Обычно устройство  
отправляет одно сообщение о нажатых клавишах, а в следующем кадре, то есть  
через 1мс отправляет сообщение где клавиши отпущены. Если по какой-то  
причине компьютер не может так быстро принимать нажатия, то указав задержку с  
"STRING_DELAY **n**" устройство будет нажимать клавишу и удерживать ее нажатой  
в течение **n** миллисекунд. После этого клавиша будет отпущена и опять ещё **n**  
миллисекунд задержки будет вставлено перед тем как ввести следующий символ.  
  
8. Команда "STRING **s**" принимает только печатные символы ASCII, максимальная длина  
строки 1000 символов. По умолчанию ожидается стандартная QWERTY раскладка клавиатуры.   
Если у вас другая раскладка, вам нужно будет изменить её с помощью "USE_LAYOUT **s**",  
это команда предварительной настройки в config.txt; иначе символы из скрипта не будут  
введены правильно. Если вы хотите ввести текст используя другой алфавит (не английский),  
вам нужно будет настроить графический интерфейс на использование желаемого языка, а  
затем использовать команду "STRING **s**" с символами ASCII, привязанными к тем же  
клавишам как и символы, которые вы пытаетесь написать. Например, если графический  
интерфейс настроен на ввод RU, команда "STRING Dtkjcbgtl CNTKC" приведёт к написанию  
строки "Велосипед СТЕЛС". (потому что вы должны нажать одну и ту же клавишу, чтобы  
ввести 'l' или 'д', та же клавиша для 'k' или 'л' итд.)  
  
9. Команды управления мышью, связанные с перемещением указателя или колёсика  
принимают десятичные аргументы в диапазоне от 0 до 127. Эти аргументы являются относительными  
значениями, которые представляют собой смещение от предыдущего местоположения и выражаются  
в логических единицах. Это полностью зависит от вашего компьютера как решить, что эти  
значения на самом деле означают и какую постобработку следует с ними выполнить. Например,  
смещение на 10 единиц может означать 10 или 20 пикселей, в зависимости от чувствительности  
мыши в настройках. Кроме того, постобработка на ПК может привести, например, к тому что  
"MOUSE_RIGHT 100" может дать другой результат чем команда "MOUSE_RIGHT 10" выполненная 10  
раз подряд. Это означает, что для успешного применения таких команд следует быть особенно  
осторожными и делать правильные предположения о целевой машине. Команды, связанные с  
перемещением указателя мыши на разных осях (или прокруткой колеса) можно объединить в одну  
строку, например, "MOUSE_RIGHT 120 MOUSE_DOWN 35 MOUSE_SCROLLUP 47" - допустимая команда.  
  
10. Доступны команды, состоящие из одного печатного символа ASCII, они будут нажимать  
указанную клавишу. Соответствующие модификаторы (левый SHIFT и правый ALT) применяются  
автоматически. То есть обе команды "m" и "M" отправляют один и тот же HID-код клавиши,  
но для "M" будет добавлен модификатор SHIFT. Это также означает, что вы должны использовать  
маленькие буквы для комбинаций клавиш, таких как "GUI r" ("GUI R" означает "GUI SHIFT r").  
Вы можете добавить дополнительные модификаторы, например: "CTRL SHIFT t" или "GUI CTRL M".  
  
11. Доступны команды "KEYCODE **n**", "KEYCODE **x**", если вы хотите нажать клавишу  
по её значению HID-кода (например, вы хотите нажать какую-то редкую клавишу).  
Допустимые значения HID-кода — от 0 до 221 (десятичное число).  
Некоторую информацию о кодах клавиш можно найти в [этом документе](https://usb.org/document-library/hid-usage-tables-14), страницы 89–96.  
С кодом можно использовать клавиши-модификаторы, например: "CTRL SHIFT KEYCODE 23"  
  
12. Команда "HOLD **s**" применяется к клавишам клавиатуры (модификаторам и обычным), а также  
мыши. Она используется всякий раз, когда вам нужно постоянно зажимать какие-то клавиши,  
например как при открытом меню выбора языка Windows 10 с помощью клавиш GUI + SPACE. Эта  
команда также влияет на работу "STRING **s**", а также любой команды **нажатия клавиш** или  
**управления мышью**. Чтобы отпустить все клавиши/щелчки, удерживаемые в данный момент,  
необходимо использовать команду "RELEASE". Если вы хотите отпустить только некоторые  
определенные клавиши, вы можете использовать несколько команд "HOLD **s**" подряд, так как они  
заменяют те клавиши, что были зажаты ранее. Например, следующая последовательность команд:  
"HOLD f g" "DELAY 500" "HOLD f" "DELAY 500" "RELEASE" удерживает клавиши "f" и "g" одновременно  
в течение 500 мс, затем отпускает только клавишу "g" и ещё спустя 500 мс отпустит "f".  
  
13. Команда "REPEAT **n**" повторяет одну или несколько предыдущих команд  
указанное количество раз. Если повторить нужно целый блок команд, то начало  
этого блока должен быть помечено командой "REPEAT_START". Размер таких блоков  
неограничен, поэтому он может охватывать даже весь рабочий скрипт целиком.  
Как только исполнение команды "REPEAT **n**" завершено, предыдущий блок команд  
считается завешенным. Для нового блока опять нужно будет указать начало  
командой "REPEAT_START". В случае использования команды "REPEAT **n**" без  
явного указания начала блока команд, только 1 команда непосредственно перед  
"REPEAT **n**" будет повторена. Некоторые примеры:  
\
Этот скрипт выполнит 3 команды прямо перед REPEAT  
11 раз (один раз по порядку + повтор 10 раз):  
"REPEAT\_START"  
"STRING this command block of 3 commands is repeated"  
"ENTER"  
"DELAY 300"  
"REPEAT 10"  
\
Этот скрипт выполнит 1 команду прямо перед REPEAT  
5 раз (один раз по порядку + повтор 4 раза):  
"CTRL ALT DELETE"  
"REPEAT 4"  
  
14. Команды "KEYREFLECT_START" и "KEYREFLECT_SAVE **n**" применяются для  
отражения нажатий. Для дополнительной информации можете изучить [эту страницу](https://github.com/krakrukra/PocketAdmin/blob/master/extra/wiki/rus/keyreflect.md)  
  